<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Study Book Debug Test</title>
</head>
<body>
    <h1>学習帳デバッグテスト</h1>
    
    <div style="margin: 20px; padding: 20px; border: 1px solid #ccc;">
        <h2>学習帳登録テスト</h2>
        <div>
            <label>言語:</label>
            <input type="text" id="test-language" value="TestLanguage" style="margin: 5px;">
        </div>
        <div>
            <label>問題:</label>
            <textarea id="test-question" style="margin: 5px; width: 300px; height: 60px;">console.log("test");</textarea>
        </div>
        <div>
            <label>解説:</label>
            <textarea id="test-explanation" style="margin: 5px; width: 300px; height: 40px;">テスト用のコード</textarea>
        </div>
        <button onclick="testCreateStudyBook()">学習帳登録テスト</button>
        <div id="create-result" style="margin-top: 10px;"></div>
    </div>
    
    <div style="margin: 20px; padding: 20px; border: 1px solid #ccc;">
        <h2>統計情報テスト</h2>
        <button onclick="testGetStats()">統計情報取得テスト</button>
        <div id="stats-result" style="margin-top: 10px;"></div>
    </div>
    
    <div style="margin: 20px; padding: 20px; border: 1px solid #ccc;">
        <h2>学習帳一覧テスト</h2>
        <button onclick="testGetStudyBooks()">学習帳一覧取得テスト</button>
        <div id="list-result" style="margin-top: 10px;"></div>
    </div>

    <script src="js/api.js"></script>
    <script>
        // デモログインを自動実行
        window.onload = async function() {
            try {
                if (!rctApi.isLoggedIn()) {
                    console.log('Auto demo login...');
                    await rctApi.demoLogin();
                    console.log('Demo login successful');
                }
            } catch (error) {
                console.error('Auto login failed:', error);
            }
        };

        async function testCreateStudyBook() {
            try {
                const language = document.getElementById('test-language').value;
                const question = document.getElementById('test-question').value;
                const explanation = document.getElementById('test-explanation').value;
                
                console.log('Testing create study book:', { language, question, explanation });
                
                const result = await rctApi.createStudyBook(language, question, explanation);
                
                document.getElementById('create-result').innerHTML = 
                    `<div style="color: green;">成功: <pre>${JSON.stringify(result, null, 2)}</pre></div>`;
                console.log('Create study book success:', result);
                
            } catch (error) {
                console.error('Create study book error:', error);
                document.getElementById('create-result').innerHTML = 
                    `<div style="color: red;">エラー: ${error.message}<br>詳細: ${error.stack}</div>`;
            }
        }

        async function testGetStats() {
            try {
                console.log('Testing get stats...');
                const result = await rctApi.getStats();
                
                document.getElementById('stats-result').innerHTML = 
                    `<div style="color: green;">成功: <pre>${JSON.stringify(result, null, 2)}</pre></div>`;
                console.log('Get stats success:', result);
                
            } catch (error) {
                console.error('Get stats error:', error);
                document.getElementById('stats-result').innerHTML = 
                    `<div style="color: red;">エラー: ${error.message}<br>詳細: ${error.stack}</div>`;
            }
        }

        async function testGetStudyBooks() {
            try {
                console.log('Testing get study books...');
                const result = await rctApi.getStudyBooks();
                
                document.getElementById('list-result').innerHTML = 
                    `<div style="color: green;">成功: <pre>${JSON.stringify(result, null, 2)}</pre></div>`;
                console.log('Get study books success:', result);
                
            } catch (error) {
                console.error('Get study books error:', error);
                document.getElementById('list-result').innerHTML = 
                    `<div style="color: red;">エラー: ${error.message}<br>詳細: ${error.stack}</div>`;
            }
        }
    </script>
</body>
</html>