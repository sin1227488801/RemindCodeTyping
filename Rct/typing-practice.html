<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>タイピング練習 - RemindCodeTyping</title>
    <link rel="stylesheet" href="css/_common.css">
    <link rel="stylesheet" href="css/typing-practice.css">
</head>
<body>
    <!-- プログレスバー付きローディング表示 -->
    <div id="loading-overlay" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: flex; justify-content: center; align-items: center; z-index: 9999;">
        <div style="background: white; padding: 40px; border-radius: 15px; text-align: center; box-shadow: 0 4px 20px rgba(0,0,0,0.3); min-width: 400px;">
            <div id="loading-message" style="font-size: 20px; margin-bottom: 10px; font-weight: bold; color: #2c3e50;">NOW LOADING...</div>
            <div id="loading-detail" style="font-size: 14px; color: #7f8c8d; margin-bottom: 25px;">システムを準備しています...</div>
            
            <!-- プログレスバー -->
            <div style="width: 100%; height: 12px; background: #ecf0f1; border-radius: 6px; margin: 20px 0; overflow: hidden; box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);">
                <div id="progress-bar" style="width: 5%; height: 100%; background: linear-gradient(90deg, #3498db, #2ecc71, #f39c12); border-radius: 6px; transition: width 0.5s ease; position: relative;">
                    <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent); animation: shimmer 2s infinite;"></div>
                </div>
            </div>
            
            <!-- 進捗パーセンテージ -->
            <div id="progress-percentage" style="font-size: 16px; font-weight: bold; color: #3498db; margin-top: 10px;">5%</div>
            
            <!-- 詳細ステップ表示 -->
            <div id="step-details" style="margin-top: 20px; font-size: 12px; color: #95a5a6;">
                <div id="step-api" style="margin: 5px 0;">⏳ APIライブラリ読み込み</div>
                <div id="step-backend" style="margin: 5px 0;">⏳ バックエンド接続</div>
                <div id="step-login" style="margin: 5px 0;">⏳ ログイン確認</div>
                <div id="step-problems" style="margin: 5px 0;">⏳ 問題読み込み</div>
            </div>
        </div>
    </div>
    <style>
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
    </style>

    <div class="typing-container typing-practice">
        <header class="typing-header">
            <h1>タイピング練習</h1>
            <div class="typing-info">
                <div class="timer">残り時間: <span id="timer">10:00</span></div>
                <div class="target-time">目標時間: <span id="target-time">--:--</span></div>
                <div class="score">スコア: <span id="score">0</span></div>
                <div class="accuracy">正答率: <span id="accuracy">100%</span></div>
            </div>
        </header>

        <main class="typing-main">
            <div class="problem-display">
                <div class="problem-info">
                    <span class="language-tag" id="current-language">Python</span>
                    <span class="problem-counter"><span id="current-problem">1</span> / <span id="total-problems">10</span></span>
                </div>
                
                <!-- 表示オプション -->
                <div class="display-options">
                    <div class="option-group">
                        <input type="checkbox" id="show-problem" checked>
                        <label for="show-problem">問題文を表示</label>
                    </div>
                </div>
                
                <!-- 特殊文字の凡例 -->
                <div class="legend">
                    <div class="legend-title">特殊文字の表示:</div>
                    <div class="legend-items">
                        <span class="legend-item">
                            <span class="space-char">·</span> = 半角スペース
                        </span>
                        <span class="legend-item">
                            <span class="tab-char">→</span> = タブ文字
                        </span>
                        <span class="legend-item">
                            <span class="newline-char">↵</span> = 改行
                        </span>
                    </div>
                </div>
                
                <!-- 問題文と入力エリアを横並びに -->
                <div class="coding-area">
                    <div class="problem-section">
                        <!-- ヒント表示（問題文の上部） -->
                        <div class="problem-explanation" id="problem-explanation" style="display: none;">
                            <!-- 解説がここに表示されます -->
                        </div>
                        
                        <div class="problem-text" id="problem-text">
                            <!-- 問題文がここに表示されます -->
                        </div>
                    </div>
                    
                    <div class="typing-section">
                        <textarea 
                            id="typing-input" 
                            placeholder="ここにコードを入力してください..."
                            spellcheck="false"
                        ></textarea>
                        <div id="completion-message" class="completion-message" style="display: none;">
                            ✅ 完了！Enterキーまたは「次へ」ボタンで次の問題に進んでください
                        </div>
                    </div>
                </div>
            </div>

            <div class="typing-controls">
                <button id="skip-button" class="btn btn-secondary">次へ</button>
                <button id="hint-button" class="btn btn-secondary">ヒント表示</button>
                <button id="pause-button" class="btn btn-primary">一時停止</button>
            </div>
        </main>

        <div class="result-modal" id="result-modal" style="display: none;">
            <div class="modal-content">
                <h2>タイピング結果</h2>
                <div class="result-stats">
                    <div class="stat">
                        <span class="stat-label">総問題数</span>
                        <span class="stat-value" id="result-total">0</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">正解数</span>
                        <span class="stat-value" id="result-correct">0</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">正答率</span>
                        <span class="stat-value" id="result-accuracy">0%</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">スコア</span>
                        <span class="stat-value" id="result-judgment-value">0</span>
                    </div>
                    <div class="stat rank-highlight">
                        <span class="stat-label">評価ランク</span>
                        <span class="stat-value rank-tooltip-trigger" id="result-rank" data-tooltip="ワープロ検定〇〇相当！">-</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">入力文字数</span>
                        <span class="stat-value" id="result-input-chars">0</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">目標時間</span>
                        <span class="stat-value" id="result-target-time">-</span>
                    </div>
                </div>
                <div class="modal-actions">
                    <div class="button-container">
                        <button id="retry-button" class="btn">もう一度</button>
                        <button id="back-button" class="btn-muted">設定に戻る</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="js/api.js"></script>
    <script src="js/typing-practice.js"></script>
</body>
</html>